dist: trusty
sudo: required

language: c

matrix:
  include:
   - os: linux
     script:
       - git submodule update --init
       - mkdir build; cd build; cmake ../; make
   - os: osx
     osx_image: xcode10
     before_install:
       - brew update
       - brew install gcc@6
       - export CC=gcc-6
       - export CXX=g++-6
       - export TRAVIS_COMPILER=gcc-6
       - export CC_FOR_BUILD=gcc-6
     script:
       - git submodule update --init
       - mkdir build; cd build; cmake ../; make
   - os: osx
     osx_image: xcode10.1
     script:
       - git submodule update --init
       - mkdir build; cd build; cmake ../; make
   - os: windows
     dist: 1803-containers
     python: "conda-32"
     before_install:
       - choco install miniconda3 --x86
       - export PATH="/c/Tools/miniconda3:/c/Tools/miniconda3/Library/mingw-w64/bin:/c/Tools/miniconda3/Library/usr/bin:/c/Tools/miniconda3/Library/bin:/c/Tools/miniconda3/Scripts:/c/Tools/miniconda3/bin:/c/Tools/miniconda3/condabin:$PATH"
       - conda info -s
       - conda update --yes conda
     script:
       - git submodule update --init
       # For MinGW make to work correctly sh.exe must NOT be in your path.
       - mv "/c/Program Files/Git/usr/bin/sh.exe" "/c/Program Files/Git/usr/bin/hidden_sh.exe"
       - ./bdist-wheel-win.bat
       - ls -la ./dist
   - os: windows
     dist: 1803-containers
     python: "conda-64"
     before_install:
       - choco install miniconda3
       - export PATH="/c/Tools/miniconda3:/c/Tools/miniconda3/Library/mingw-w64/bin:/c/Tools/miniconda3/Library/usr/bin:/c/Tools/miniconda3/Library/bin:/c/Tools/miniconda3/Scripts:/c/Tools/miniconda3/bin:/c/Tools/miniconda3/condabin:$PATH"
       - conda info -s
       - conda update --yes conda
     script:
       - git submodule update --init
       # For MinGW make to work correctly sh.exe must NOT be in your path.
       - mv "/c/Program Files/Git/usr/bin/sh.exe" "/c/Program Files/Git/usr/bin/hidden_sh.exe"
       - ./bdist-wheel-win.bat
       - ls -la ./dist

git:
  depth: 1
  submodules: false # Don't do recursive init

cache:
  apt: true
  pip: true

branches:
  only:
    - master
      # Any tag starting with a version string: vX.Y.Z(-blahblahblah).
    - /^v\d+.\d+.\d+(-\S+)?$/
